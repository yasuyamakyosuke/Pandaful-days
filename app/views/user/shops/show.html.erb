<div class ="container">
  <div class ="row">
    <div class ="col-9">
  	  <h2>店舗詳細ページ</h2>
  	  <%= attachment_image_tag @shop, :main, :fill, 150, 150 %>
  	  <% @shop.shop_images.each do |image| %>
  	    <%= attachment_image_tag image, :image, :fill,100, 100 %>
  	  <% end %>
      <% if @shop.favorited_by?(current_user) %>
        <li>
          <%= link_to shop_favorites_path(@shop), method: :delete do %>
        <i class="fa fa-heart" aria-hidden="true" style="color: red;"></i>
          <%= @shop.favorites.count %> 行ってみたい
          <% end %>
        </li>
        <% else %>
        <li>
          <%= link_to shop_favorites_path(@shop), method: :post do %>
            <i class="fa fa-heart-o" aria-hidden="true"></i>
            <%= @shop.favorites.count %> 行ってみたい
           <% end %>
        </li>
        <% end %>
      <table class ='table'>
   	    <tr>
   	      <th>店名</th>
   	      <td><%= @shop.shop_name %></td>
   	    </tr>
   	    <tr>
   	      <th>店紹介文</th>
   	      <td><%= @shop.shop_profile %></td>
   	    </tr>
   	    <tr>
   	      <th>ジャンル</th>
   	      <td><%= @shop.genre.genre_name %></td>
   	    </tr>
   	    <tr>
   	      <th>駅</th>
   	      <td><%= @shop.station.station_name %></td>
   	    </tr>
   	    <tr>
   	      <th>住所</th>
   	      <td><%= @shop.shop_address %>
            <div id="map">
　          </div>
          </td>
        </tr>
   	    <tr>
   	      <th>営業時間</th>
   	      <td><%= @shop.shop_time.strftime('%H:%M') %></td>
   	    </tr>
        <tr>
          <th>休日</th>
          <td><%= @shop.holiday %>
        </td>
   	    <tr>
   	      <th>ホームページ</th>
   	      <td><%= @shop.shop_homepage %></td>
   	    </tr>
      </table>
        <h2>コメント</h2>
        <% @shop.shop_comments.each do |shop_comment| %>
            <div class="comment-body bb">
              <div class="comment-avatar">
                <div class="avatar">
                  <%= attachment_image_tag shop_comment.user,:image, :fill,40, 0,fallback: "download.png",size:'40x40' %>
                </div>
              </div>
              <div class="comment-text">
                <div class="comment-author clearfix">
                  <a href="#" class="link-author"><%= shop_comment.user.name %></a>
                  <span class="comment-meta">
                    <span class="comment-date"><%= shop_comment.created_at.strftime('%Y/%m/%d') %>
                  </span>
                </span>
                <div id="star-rate-<%= shop_comment.id %>"></div>
                  <script>
                  $('#star-rate-<%= shop_comment.id %>').raty({
                  size: 36,
                  starOff:  '<%= asset_path('star-off.png') %>',
                  starOn : '<%= asset_path('star-on.png') %>',
                  starHalf: '<%= asset_path('star-half.png') %>',
                  half: true,
                  readOnly: true,
                  score: <%= shop_comment.score %>,
                  });
                  </script>
                <div class="comment-entry"><%= shop_comment.comment %></div>
                <% if shop_comment.user == current_user %>
                  <%= link_to "削除", shop_shop_comment_path(shop_comment.shop, shop_comment), method: :delete %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      <% if user_signed_in? %>
   　　　<%= form_for [@shop, @shop_comment] do |f| %>
     　　  <div class="form-group row" id="star">
       　    <%= f.label :score,'評価 ', class:'col-md-3 col-form-label' %>
             <%= f.hidden_field :score, id: :review_star %>
          </div>
          <script>
            $('#star').raty({
            size     : 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            scoreName: 'shop_comment[score]',
            half: true
            });
          </script>
          <%= f.text_area :comment, rows:'5', class: "form-control",placeholder: "コメントをここに" %>
          <%= f.submit "送信する", class: "btn btn-lg btn-base-1 mt-20 pull-right" %>
        <% end %>
      <% else %>
        <a>会員登録して評価・コメントしよう</a>
      <% end %>
    </div>
  </div>
</div>

<style>
#map{
  height: 250px; width: 300px;
}
</style>

<script>
  let mapInstance //この変数はmap.js.erbでも使うのでタイプミスに注意

  function initMap(){
    mapInstance = new google.maps.Map(document.getElementById('map'), {
    center: {lat:<%= @shop.latitude %>, lng:<%= @shop.longitude %>},
    zoom: 15
    });
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC30kzKCnQ8odDeG-M8ho3u14N5p-aXbXQ&callback=initMap" async defer></script>

